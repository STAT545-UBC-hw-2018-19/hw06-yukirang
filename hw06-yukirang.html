<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>hw06_yukirang</title>

<script src="hw06-yukirang_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="hw06-yukirang_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="hw06-yukirang_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="hw06-yukirang_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="hw06-yukirang_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="hw06-yukirang_files/navigation-1.1/tabsets.js"></script>
<link href="hw06-yukirang_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="hw06-yukirang_files/highlightjs-9.12.0/highlight.js"></script>
<script src="hw06-yukirang_files/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="hw06-yukirang_files/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="hw06-yukirang_files/str_view-binding-1.3.1/str_view.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">hw06_yukirang</h1>

</div>


<pre class="r"><code>library(gapminder)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(stringr)
library(ggplot2)</code></pre>
<div id="character-data" class="section level1">
<h1>1. Character data</h1>
<div id="string-length" class="section level3">
<h3>String length</h3>
<p>Try with different type of data, both the number and logical variable are trasferred to string.</p>
<pre class="r"><code>str_length(c(&quot;This&quot;, &quot;is&quot;, 233, TRUE))</code></pre>
<pre><code>## [1] 4 2 3 4</code></pre>
</div>
<div id="combining-strings" class="section level3">
<h3>Combining strings</h3>
<pre class="r"><code>str_c(&quot;1&quot;, &quot;22&quot;, &quot;333&quot;)</code></pre>
<pre><code>## [1] &quot;122333&quot;</code></pre>
<p>Combining with a separater:</p>
<pre class="r"><code>str_c(&quot;Try&quot;, &quot;this&quot;, sep = &quot;%&quot;)</code></pre>
<pre><code>## [1] &quot;Try%this&quot;</code></pre>
</div>
<div id="subsetting-strings" class="section level3">
<h3>Subsetting strings</h3>
<p>str_sub() takes start and end arguments which give the (inclusive) position of the substring:</p>
<pre class="r"><code>(x &lt;- c(&quot;We &quot;, &quot;ar e &quot;, &quot;family&quot;,&quot;!&quot;))</code></pre>
<pre><code>## [1] &quot;We &quot;    &quot;ar e &quot;  &quot;family&quot; &quot;!&quot;</code></pre>
<pre class="r"><code>str_sub(x, 2, 4)</code></pre>
<pre><code>## [1] &quot;e &quot;  &quot;r e&quot; &quot;ami&quot; &quot;&quot;</code></pre>
</div>
<div id="locales" class="section level3">
<h3>Locales</h3>
<p>Changing case:</p>
<pre class="r"><code>str_to_upper(c(&quot;a&quot;, &quot;i&quot;))</code></pre>
<pre><code>## [1] &quot;A&quot; &quot;I&quot;</code></pre>
<p>Sorting by English alphabetically:</p>
<pre class="r"><code>str_sort(x, locale = &quot;en&quot;)</code></pre>
<pre><code>## [1] &quot;!&quot;      &quot;ar e &quot;  &quot;family&quot; &quot;We &quot;</code></pre>
<p>Removing the wrapping spaces:</p>
<pre class="r"><code>str_wrap(x)</code></pre>
<pre><code>## [1] &quot;We&quot;     &quot;ar e&quot;   &quot;family&quot; &quot;!&quot;</code></pre>
</div>
<div id="matching" class="section level3">
<h3>Matching</h3>
<p>1.Basic matching:</p>
<pre class="r"><code>str_view(x, &quot;a&quot;)</code></pre>
<p><div id="htmlwidget-cd79a83ec9049222f3fb" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-cd79a83ec9049222f3fb">{"x":{"html":"<ul>\n  <li>We <\/li>\n  <li><span class='match'>a<\/span>r e <\/li>\n  <li>f<span class='match'>a<\/span>mily<\/li>\n  <li>!<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> Matching any character with “.”</p>
<pre class="r"><code>str_view(x, &quot;.a.&quot;)</code></pre>
<p><div id="htmlwidget-53a7a2db7adcaf9f1484" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-53a7a2db7adcaf9f1484">{"x":{"html":"<ul>\n  <li>We <\/li>\n  <li>ar e <\/li>\n  <li><span class='match'>fam<\/span>ily<\/li>\n  <li>!<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> 2.Anchors Start matching:</p>
<pre class="r"><code>str_view(x, &quot;^a&quot;)</code></pre>
<p><div id="htmlwidget-455a28a21db77284316d" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-455a28a21db77284316d">{"x":{"html":"<ul>\n  <li>We <\/li>\n  <li><span class='match'>a<\/span>r e <\/li>\n  <li>family<\/li>\n  <li>!<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> End matching:</p>
<pre class="r"><code>str_view(x, &quot;y$&quot;)</code></pre>
<p><div id="htmlwidget-2cb658079fd5d6d5f863" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-2cb658079fd5d6d5f863">{"x":{"html":"<ul>\n  <li>We <\/li>\n  <li>ar e <\/li>\n  <li>famil<span class='match'>y<\/span><\/li>\n  <li>!<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> 3.Character classes and alternatives</p>
<pre class="r"><code>str_view(c(&quot;abc&quot;, &quot;a.c&quot;, &quot;a..c&quot;, &quot;a.c.&quot;), &quot;a[.]c&quot;)</code></pre>
<p><div id="htmlwidget-b352cbbcd74f3687ee2d" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b352cbbcd74f3687ee2d">{"x":{"html":"<ul>\n  <li>abc<\/li>\n  <li><span class='match'>a.c<\/span><\/li>\n  <li>a..c<\/li>\n  <li><span class='match'>a.c<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> Matching with a “|” character:</p>
<pre class="r"><code>str_view(c(&quot;brace&quot;, &quot;bruce&quot;), &quot;br(a|u)c.&quot;)</code></pre>
<p><div id="htmlwidget-90f2bad34faf7ec498c5" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-90f2bad34faf7ec498c5">{"x":{"html":"<ul>\n  <li><span class='match'>brace<\/span><\/li>\n  <li><span class='match'>bruce<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> ### Repetition</p>
<pre class="r"><code>y &lt;- &quot;I&#39;m loooooooving it!&quot;
str_view(y, &quot;oo?&quot;)</code></pre>
<p><div id="htmlwidget-7b2863d1712e68bd320e" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-7b2863d1712e68bd320e">{"x":{"html":"<ul>\n  <li>I'm l<span class='match'>oo<\/span>oooooving it!<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> Specify a repitition time:</p>
<pre class="r"><code>str_view(y, &quot;o{2,}&quot;)</code></pre>
<p><div id="htmlwidget-090b7ab1cec5ccaab06f" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-090b7ab1cec5ccaab06f">{"x":{"html":"<ul>\n  <li>I'm l<span class='match'>ooooooo<\/span>ving it!<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> ### Tools Detect matches:</p>
<pre class="r"><code>x</code></pre>
<pre><code>## [1] &quot;We &quot;    &quot;ar e &quot;  &quot;family&quot; &quot;!&quot;</code></pre>
<pre class="r"><code>str_detect(x, &quot;a&quot;)</code></pre>
<pre><code>## [1] FALSE  TRUE  TRUE FALSE</code></pre>
<p>Subsets:</p>
<pre class="r"><code>str_subset(words, &quot;go$&quot;)</code></pre>
<pre><code>## [1] &quot;ago&quot; &quot;go&quot;</code></pre>
<p>With filtering:</p>
<pre class="r"><code>df &lt;- tibble(
  word = words, 
  i = seq_along(word)
)
df %&gt;% 
  filter(str_detect(word, &quot;go$&quot;))</code></pre>
<pre><code>## # A tibble: 2 x 2
##   word      i
##   &lt;chr&gt; &lt;int&gt;
## 1 ago      24
## 2 go      360</code></pre>
<p>Counting:</p>
<pre class="r"><code>z &lt;- c(&quot;ah&quot;,&quot;haha&quot;,&quot;aaaaaa&quot;)
str_count(z, &quot;a&quot;)</code></pre>
<pre><code>## [1] 1 2 6</code></pre>
<p>Mean:</p>
<pre class="r"><code># The mean of  vowels per word
mean(str_count(z, &quot;[aeiou]&quot;))</code></pre>
<pre><code>## [1] 3</code></pre>
<p>Replacing matches:</p>
<pre class="r"><code>x &lt;- c(&quot;Escape&quot;, &quot;your&quot;, &quot;comfort&quot;,&quot;zone&quot;)
# replace the first matching element
str_replace(x, &quot;[aeiou]&quot;, &quot;-&quot;)</code></pre>
<pre><code>## [1] &quot;Esc-pe&quot;  &quot;y-ur&quot;    &quot;c-mfort&quot; &quot;z-ne&quot;</code></pre>
<pre class="r"><code># replace all matching element
str_replace_all(x, &quot;[aeiou]&quot;, &quot;-&quot;)</code></pre>
<pre><code>## [1] &quot;Esc-p-&quot;  &quot;y--r&quot;    &quot;c-mf-rt&quot; &quot;z-n-&quot;</code></pre>
</div>
<div id="splitting" class="section level3">
<h3>Splitting</h3>
<pre class="r"><code>(a &lt;- sentences %&gt;%
  head(6) %&gt;% 
  #use &quot;simplify = TRUE&quot; to return a matrix
  str_split(&quot; &quot;, simplify = TRUE))</code></pre>
<pre><code>##      [,1]    [,2]    [,3]    [,4]      [,5]    [,6]    [,7]    
## [1,] &quot;The&quot;   &quot;birch&quot; &quot;canoe&quot; &quot;slid&quot;    &quot;on&quot;    &quot;the&quot;   &quot;smooth&quot;
## [2,] &quot;Glue&quot;  &quot;the&quot;   &quot;sheet&quot; &quot;to&quot;      &quot;the&quot;   &quot;dark&quot;  &quot;blue&quot;  
## [3,] &quot;It&#39;s&quot;  &quot;easy&quot;  &quot;to&quot;    &quot;tell&quot;    &quot;the&quot;   &quot;depth&quot; &quot;of&quot;    
## [4,] &quot;These&quot; &quot;days&quot;  &quot;a&quot;     &quot;chicken&quot; &quot;leg&quot;   &quot;is&quot;    &quot;a&quot;     
## [5,] &quot;Rice&quot;  &quot;is&quot;    &quot;often&quot; &quot;served&quot;  &quot;in&quot;    &quot;round&quot; &quot;bowls.&quot;
## [6,] &quot;The&quot;   &quot;juice&quot; &quot;of&quot;    &quot;lemons&quot;  &quot;makes&quot; &quot;fine&quot;  &quot;punch.&quot;
##      [,8]          [,9]   
## [1,] &quot;planks.&quot;     &quot;&quot;     
## [2,] &quot;background.&quot; &quot;&quot;     
## [3,] &quot;a&quot;           &quot;well.&quot;
## [4,] &quot;rare&quot;        &quot;dish.&quot;
## [5,] &quot;&quot;            &quot;&quot;     
## [6,] &quot;&quot;            &quot;&quot;</code></pre>
<p>Find matches</p>
<pre class="r"><code>x</code></pre>
<pre><code>## [1] &quot;Escape&quot;  &quot;your&quot;    &quot;comfort&quot; &quot;zone&quot;</code></pre>
<pre class="r"><code>str_locate(x, &quot;your&quot;)</code></pre>
<pre><code>##      start end
## [1,]    NA  NA
## [2,]     1   4
## [3,]    NA  NA
## [4,]    NA  NA</code></pre>
</div>
<div id="other-types-of-pattern" class="section level3">
<h3>Other types of pattern</h3>
<p>Apply regex() to control details of the match Ignore the case:</p>
<pre class="r"><code>x</code></pre>
<pre><code>## [1] &quot;Escape&quot;  &quot;your&quot;    &quot;comfort&quot; &quot;zone&quot;</code></pre>
<pre class="r"><code>str_view(x, regex(&quot;e&quot;, ignore_case = TRUE))</code></pre>
<p><div id="htmlwidget-ca3198830d410bd2c838" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ca3198830d410bd2c838">{"x":{"html":"<ul>\n  <li><span class='match'>E<\/span>scape<\/li>\n  <li>your<\/li>\n  <li>comfort<\/li>\n  <li>zon<span class='match'>e<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script> coll(): compare strings using standard collation rules.</p>
<pre class="r"><code>a &lt;- c(&quot;A&quot;, &quot;a&quot;)
str_subset(a, coll(&quot;a&quot;, ignore_case = TRUE))</code></pre>
<pre><code>## [1] &quot;A&quot; &quot;a&quot;</code></pre>
<p>use boundary() to match boundaries:</p>
<pre class="r"><code>x</code></pre>
<pre><code>## [1] &quot;Escape&quot;  &quot;your&quot;    &quot;comfort&quot; &quot;zone&quot;</code></pre>
<pre class="r"><code>str_extract_all(x, boundary(&quot;word&quot;))</code></pre>
<pre><code>## [[1]]
## [1] &quot;Escape&quot;
## 
## [[2]]
## [1] &quot;your&quot;
## 
## [[3]]
## [1] &quot;comfort&quot;
## 
## [[4]]
## [1] &quot;zone&quot;</code></pre>
</div>
<div id="other-uses-of-regular-expressions" class="section level3">
<h3>Other uses of regular expressions</h3>
<p>Searching from the global environment:</p>
<pre class="r"><code>apropos(&quot;split&quot;)</code></pre>
<pre><code>##  [1] &quot;split&quot;              &quot;split.data.frame&quot;   &quot;split.Date&quot;        
##  [4] &quot;split.default&quot;      &quot;split.POSIXct&quot;      &quot;split.screen&quot;      
##  [7] &quot;split&lt;-&quot;            &quot;split&lt;-.data.frame&quot; &quot;split&lt;-.default&quot;   
## [10] &quot;str_split&quot;          &quot;str_split_fixed&quot;    &quot;strsplit&quot;          
## [13] &quot;unsplit&quot;</code></pre>
</div>
</div>
<div id="work-with-a-nested-data-frame" class="section level1">
<h1>6. Work with a nested data frame</h1>
<div id="nest-the-data-by-country-and-continent" class="section level3">
<h3>Nest the data by country (and continent’)</h3>
<p>Let’s first grab a sense of the data without nesting:</p>
<pre class="r"><code>gap_nested &lt;- gapminder %&gt;% 
   group_by(continent, country)
summary(gap_nested)</code></pre>
<pre><code>##         country        continent        year         lifeExp     
##  Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.60  
##  Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.20  
##  Algeria    :  12   Asia    :396   Median :1980   Median :60.71  
##  Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.47  
##  Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.85  
##  Australia  :  12                  Max.   :2007   Max.   :82.60  
##  (Other)    :1632                                                
##       pop              gdpPercap       
##  Min.   :6.001e+04   Min.   :   241.2  
##  1st Qu.:2.794e+06   1st Qu.:  1202.1  
##  Median :7.024e+06   Median :  3531.8  
##  Mean   :2.960e+07   Mean   :  7215.3  
##  3rd Qu.:1.959e+07   3rd Qu.:  9325.5  
##  Max.   :1.319e+09   Max.   :113523.1  
## </code></pre>
<pre class="r"><code>gap_nested %&gt;% 
  head(10) </code></pre>
<pre><code>## # A tibble: 10 x 6
## # Groups:   continent, country [1]
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.</code></pre>
<p>And now nest the data:</p>
<pre class="r"><code>(gap_nested &lt;- gap_nested %&gt;% 
   nest())</code></pre>
<pre><code>## # A tibble: 142 x 3
##    continent country     data             
##    &lt;fct&gt;     &lt;fct&gt;       &lt;list&gt;           
##  1 Asia      Afghanistan &lt;tibble [12 × 4]&gt;
##  2 Europe    Albania     &lt;tibble [12 × 4]&gt;
##  3 Africa    Algeria     &lt;tibble [12 × 4]&gt;
##  4 Africa    Angola      &lt;tibble [12 × 4]&gt;
##  5 Americas  Argentina   &lt;tibble [12 × 4]&gt;
##  6 Oceania   Australia   &lt;tibble [12 × 4]&gt;
##  7 Europe    Austria     &lt;tibble [12 × 4]&gt;
##  8 Asia      Bahrain     &lt;tibble [12 × 4]&gt;
##  9 Asia      Bangladesh  &lt;tibble [12 × 4]&gt;
## 10 Europe    Belgium     &lt;tibble [12 × 4]&gt;
## # ... with 132 more rows</code></pre>
<p>We now see there are seperate tibbles for different countries.</p>
</div>
<div id="fit-a-model-of-life-expectancy-against-year" class="section level3">
<h3>Fit a model of life expectancy against year</h3>
<p>Let’s see the change of lifeExp over year of China:</p>
<pre class="r"><code>(my_lm &lt;- lm(lifeExp ~ log(gdpPercap), data=gap_nested[[25, &quot;data&quot;]]))</code></pre>
<pre><code>## 
## Call:
## lm(formula = lifeExp ~ log(gdpPercap), data = gap_nested[[25, 
##     &quot;data&quot;]])
## 
## Coefficients:
##    (Intercept)  log(gdpPercap)  
##         -15.73           11.09</code></pre>
<pre class="r"><code>ggplot(gap_nested[[25, &quot;data&quot;]], aes(year, lifeExp)) +
    geom_point() +
    geom_smooth(method=&quot;lm&quot;) +
    ggtitle(&quot;Linear Regression Model Fitted of lifeExp against year on China&quot;)</code></pre>
<p><img src="hw06-yukirang_files/figure-html/unnamed-chunk-31-1.png" /><!-- --></p>
</div>
<div id="apply-a-function-map-and-mutate" class="section level3">
<h3>Apply a function map() and mutate()</h3>
<pre class="r"><code># the fitted model
my_lm &lt;- function(df) {
  lm(lifeExp ~ I(year - 1950), data = df)
}
my_lm(gap_nested[[25, &quot;data&quot;]])</code></pre>
<pre><code>## 
## Call:
## lm(formula = lifeExp ~ I(year - 1950), data = df)
## 
## Coefficients:
##    (Intercept)  I(year - 1950)  
##        46.1291          0.5307</code></pre>
<pre class="r"><code>#map() the fitting function my_lm() to the 25th(China) and 26th(Colombia) elements of gap_nested$data.
fits &lt;- map(gap_nested$data[25:26], my_lm)
fits</code></pre>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = lifeExp ~ I(year - 1950), data = df)
## 
## Coefficients:
##    (Intercept)  I(year - 1950)  
##        46.1291          0.5307  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = lifeExp ~ I(year - 1950), data = df)
## 
## Coefficients:
##    (Intercept)  I(year - 1950)  
##        52.6656          0.3808</code></pre>
<p>Scale this up to all countries:</p>
<pre class="r"><code>(gap_nested &lt;- gap_nested %&gt;% 
   mutate(fit = map(data, my_lm)))</code></pre>
<pre><code>## # A tibble: 142 x 4
##    continent country     data              fit     
##    &lt;fct&gt;     &lt;fct&gt;       &lt;list&gt;            &lt;list&gt;  
##  1 Asia      Afghanistan &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  2 Europe    Albania     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  3 Africa    Algeria     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  4 Africa    Angola      &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  5 Americas  Argentina   &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  6 Oceania   Australia   &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  7 Europe    Austria     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  8 Asia      Bahrain     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
##  9 Asia      Bangladesh  &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
## 10 Europe    Belgium     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt;
## # ... with 132 more rows</code></pre>
<p>Now we have an extra list of fitted linear models.</p>
</div>
<div id="other-information-out-of-the-linear-models" class="section level3">
<h3>Other information out of the linear models:</h3>
<p>1.“tidy” Intercept and slope:</p>
<pre class="r"><code>library(broom)
tidy(gap_nested$fit[[25]]) </code></pre>
<pre><code>## # A tibble: 2 x 5
##   term           estimate std.error statistic       p.value
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 (Intercept)      46.1      2.20       20.9  0.00000000138
## 2 I(year - 1950)    0.531    0.0645      8.23 0.00000921</code></pre>
<p>Extend to all other countries:</p>
<pre class="r"><code>(gap_nested &lt;- gap_nested %&gt;% 
  mutate(tidy = map(fit, tidy)))</code></pre>
<pre><code>## # A tibble: 142 x 5
##    continent country     data              fit      tidy            
##    &lt;fct&gt;     &lt;fct&gt;       &lt;list&gt;            &lt;list&gt;   &lt;list&gt;          
##  1 Asia      Afghanistan &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  2 Europe    Albania     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  3 Africa    Algeria     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  4 Africa    Angola      &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  5 Americas  Argentina   &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  6 Oceania   Australia   &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  7 Europe    Austria     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  8 Asia      Bahrain     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
##  9 Asia      Bangladesh  &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
## 10 Europe    Belgium     &lt;tibble [12 × 4]&gt; &lt;S3: lm&gt; &lt;tibble [2 × 5]&gt;
## # ... with 132 more rows</code></pre>
<p>Now we have a tidy column of several tibbles.</p>
<ol start="2" style="list-style-type: decimal">
<li>One row summary using glance():</li>
</ol>
<pre class="r"><code>glance(gap_nested$fit[[25]])</code></pre>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
## *     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.871         0.858  3.86      67.7 9.21e-6     2  -32.1  70.3  71.7
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>Looks like we get a bunch of statistical data:)</p>
<ol start="3" style="list-style-type: decimal">
<li>Augment the original data with other columns:</li>
</ol>
<pre class="r"><code>augment(gap_nested$fit[[25]])</code></pre>
<pre><code>## # A tibble: 12 x 9
##    lifeExp I.year...1950. .fitted .se.fit .resid   .hat .sigma .cooksd
##  *   &lt;dbl&gt;       &lt;I(dbl)&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1    44                2    47.2    2.09 -3.19  0.295    3.86 2.03e-1
##  2    50.5              7    49.8    1.83  0.705 0.225    4.06 6.25e-3
##  3    44.5             12    52.5    1.59 -8.00  0.169    2.82 5.26e-1
##  4    58.4             17    55.2    1.37  3.23  0.127    3.90 5.85e-2
##  5    63.1             22    57.8    1.21  5.31  0.0991   3.61 1.16e-1
##  6    64.0             27    60.5    1.13  3.51  0.0851   3.88 4.21e-2
##  7    65.5             32    63.1    1.13  2.41  0.0851   3.98 1.99e-2
##  8    67.3             37    65.8    1.21  1.51  0.0991   4.03 9.33e-3
##  9    68.7             42    68.4    1.37  0.271 0.127    4.06 4.11e-4
## 10    70.4             47    71.1    1.59 -0.647 0.169    4.06 3.44e-3
## 11    72.0             52    73.7    1.83 -1.70  0.225    4.01 3.63e-2
## 12    73.0             57    76.4    2.09 -3.42  0.295    3.83 2.33e-1
## # ... with 1 more variable: .std.resid &lt;dbl&gt;</code></pre>
<p>Now we have several colums, with the fitted rows of lifeExp. 4. unnest the data in the dataframe:</p>
<pre class="r"><code>(gap_coefs &lt;- gap_nested %&gt;% 
   select(continent, country, tidy) %&gt;% 
   unnest())</code></pre>
<pre><code>## # A tibble: 284 x 7
##    continent country     term        estimate std.error statistic  p.value
##    &lt;fct&gt;     &lt;fct&gt;       &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 Asia      Afghanistan (Intercept)   29.4     0.699       42.0  1.40e-12
##  2 Asia      Afghanistan I(year - 1…    0.275   0.0205      13.5  9.84e- 8
##  3 Europe    Albania     (Intercept)   58.6     1.13        51.7  1.79e-13
##  4 Europe    Albania     I(year - 1…    0.335   0.0332      10.1  1.46e- 6
##  5 Africa    Algeria     (Intercept)   42.2     0.756       55.8  8.22e-14
##  6 Africa    Algeria     I(year - 1…    0.569   0.0221      25.7  1.81e-10
##  7 Africa    Angola      (Intercept)   31.7     0.804       39.4  2.63e-12
##  8 Africa    Angola      I(year - 1…    0.209   0.0235       8.90 4.59e- 6
##  9 Americas  Argentina   (Intercept)   62.2     0.167      372.   4.80e-22
## 10 Americas  Argentina   I(year - 1…    0.232   0.00489     47.4  4.22e-13
## # ... with 274 more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Adding the previous scope and intercept with recode():</li>
</ol>
<pre class="r"><code>(gap_coefs &lt;- gap_coefs %&gt;%
   mutate(term = recode(term,
                        `(Intercept)` = &quot;intercept&quot;,
                        `I(year - 1950)` = &quot;slope&quot;)))</code></pre>
<pre><code>## # A tibble: 284 x 7
##    continent country     term      estimate std.error statistic  p.value
##    &lt;fct&gt;     &lt;fct&gt;       &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 Asia      Afghanistan intercept   29.4     0.699       42.0  1.40e-12
##  2 Asia      Afghanistan slope        0.275   0.0205      13.5  9.84e- 8
##  3 Europe    Albania     intercept   58.6     1.13        51.7  1.79e-13
##  4 Europe    Albania     slope        0.335   0.0332      10.1  1.46e- 6
##  5 Africa    Algeria     intercept   42.2     0.756       55.8  8.22e-14
##  6 Africa    Algeria     slope        0.569   0.0221      25.7  1.81e-10
##  7 Africa    Angola      intercept   31.7     0.804       39.4  2.63e-12
##  8 Africa    Angola      slope        0.209   0.0235       8.90 4.59e- 6
##  9 Americas  Argentina   intercept   62.2     0.167      372.   4.80e-22
## 10 Americas  Argentina   slope        0.232   0.00489     47.4  4.22e-13
## # ... with 274 more rows</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Reshaping the estimates of each continents and make a summary:</li>
</ol>
<pre class="r"><code>(gap_ests &lt;- gap_coefs %&gt;% 
   select(continent:estimate) %&gt;% 
   spread(key = term, value = estimate))</code></pre>
<pre><code>## # A tibble: 142 x 4
##    continent country                  intercept  slope
##    &lt;fct&gt;     &lt;fct&gt;                        &lt;dbl&gt;  &lt;dbl&gt;
##  1 Africa    Algeria                       42.2 0.569 
##  2 Africa    Angola                        31.7 0.209 
##  3 Africa    Benin                         38.9 0.334 
##  4 Africa    Botswana                      52.8 0.0607
##  5 Africa    Burkina Faso                  34.0 0.364 
##  6 Africa    Burundi                       40.3 0.154 
##  7 Africa    Cameroon                      40.7 0.250 
##  8 Africa    Central African Republic      38.4 0.184 
##  9 Africa    Chad                          39.3 0.253 
## 10 Africa    Comoros                       39.1 0.450 
## # ... with 132 more rows</code></pre>
<pre class="r"><code>gap_ests %&gt;% 
  select(intercept, slope) %&gt;% 
  summary()</code></pre>
<pre><code>##    intercept         slope         
##  Min.   :27.24   Min.   :-0.09302  
##  1st Qu.:39.36   1st Qu.: 0.20832  
##  Median :47.42   Median : 0.32145  
##  Mean   :49.86   Mean   : 0.32590  
##  3rd Qu.:62.05   3rd Qu.: 0.44948  
##  Max.   :71.95   Max.   : 0.77218</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Making a plot of the whole distribution:</li>
</ol>
<pre class="r"><code>ggplot(gap_coefs, aes(x = estimate)) +
  geom_density() + 
  # assing a density projection on the x-axis
  geom_rug() +
  # using scales to expand the plot throughly
  facet_wrap(~ term, scales = &quot;free&quot;)</code></pre>
<p><img src="hw06-yukirang_files/figure-html/unnamed-chunk-41-1.png" /><!-- --></p>
<p>Inspiration for the modelling and downstream inspiration： * From the plot of linear regression model fitted on China, it is easy to notice that the linear model doesn’t fitted very well. There is a dramatical change of lifeExp between 1950s and 1970s. And the the slope becomes smallers. * From the residual we notice that during the high range of lifeExp, say 70+, it doesn’t performs that well cause it stays negative and keeps going down. While from 58 to 70+, it keeps going done.</p>
<ul>
<li>From the std.error we can also find that the data of Zimbabwe, Rwanda and Swaziland seems not that suitable for our model. Let’s see what’s going on:</li>
</ul>
<pre class="r"><code>other &lt;- gapminder %&gt;% 
  filter(country == &quot;Zimbabwe&quot; | country == &quot;Rwanda&quot; | country == &quot;Swaziland&quot;) %&gt;% 
  data.frame()
other %&gt;% 
  ggplot(aes(year, lifeExp, colour=country)) +
  geom_smooth(se = FALSE,method = &quot;lm&quot;) + # fit linear regression
  geom_point() +
  ggtitle(&quot;Linear Regression Model Fitted of lifeExp against year&quot;)</code></pre>
<p><img src="hw06-yukirang_files/figure-html/unnamed-chunk-42-1.png" /><!-- --> What if we try some different methods? Mabe for one distinct country loess performs better. However this can be overfitting when it is extended.</p>
<pre class="r"><code>other %&gt;% 
  filter(country == &quot;Zimbabwe&quot;) %&gt;% 
  ggplot(aes(year, lifeExp, colour = &quot;country&quot;)) +
  geom_smooth(method = &quot;loess&quot;) + # fit linear regression
  geom_point() +
  ggtitle(&quot;Linear Regression Model Fitted of lifeExp against year on Zimbabwe&quot;)</code></pre>
<p><img src="hw06-yukirang_files/figure-html/unnamed-chunk-43-1.png" /><!-- --></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
